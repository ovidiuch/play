(function(root,factory){if(typeof define==="function"&&define.amd){define(factory)}else{root.Play=factory()}})(this,function(){var extend=function(obj){var sources=Array.prototype.slice.call(arguments,1),source,i;for(i=0;i<sources.length;i++){source=sources[i];if(source){for(var prop in source){obj[prop]=source[prop]}}}return obj};var now=function(){return(new Date).getTime()};var Play=function(id,options){this.id=id;this.options=extend({},this.defaults,options||{});if(typeof this.options.onFrame!="function"){throw new Error("Play instance is missing an onFrame callback")}if(this.options.easing&&typeof this.options.easing!="function"){throw new Error("Play easing must be a Function")}this.init()};extend(Play,{stack:[],lastId:0,start:function(options){if(options.id===undefined){options.id=++this.lastId}var instance=this.getInstanceById(options.id);if(instance){this.end(instance)}instance=new Play(options.id,options);if(instance.t2<instance.t1){return}var time=now();instance.onFrame(time);if(instance.t2>time){Play.push(instance)}return instance},end:function(instance){instance.onFrame(instance.t2);this.stop(instance)},stop:function(instance){var positionInStack=this.stack.indexOf(instance);if(positionInStack!==-1){this.stack.splice(positionInStack,1)}},push:function(instance){if(!this.interval){this.startAnimationLoop()}this.stack.push(instance)},getInstanceById:function(id){for(var i=0;i<this.stack.length;i++){if(this.stack[i].id==id){return this.stack[i]}}},startAnimationLoop:function(){if(this.interval){return}var _this=this;this.interval=setInterval(function(){_this.onFrame(now())},13)},stopAnimationLoop:function(){clearInterval(this.interval);this.interval=null},onFrame:function(time,deleteIndex){if(deleteIndex!==undefined){this.stack.splice(deleteIndex,1);if(!this.stack.length){this.stopAnimationLoop()}}var instance;for(var i=deleteIndex||0;i<this.stack.length;i++){instance=this.stack[i];instance.onFrame(time);if(instance.t2<=time){this.onFrame(time,i)}}},prototype:{defaults:{time:0,ratio:0},init:function(){this.t1=now();this.t2=this.t1+this.options.time*1e3;if(this.options.ratio){var offset=(this.t2-this.t1)*this.options.ratio;this.t1-=offset;this.t2-=offset}},onFrame:function(time){var ratio;if(this.t2!=this.t1){ratio=Math.min((time-this.t1)/(this.t2-this.t1),1)}else{ratio=1}if(this.options.easing){ratio=this.options.easing.call(this,ratio)}this.options.onFrame.call(this,ratio)}}});return Play});